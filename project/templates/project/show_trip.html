<!-- project/templates/project/show_trip.html -->
{% extends 'project/base.html' %}

{% block content %}
{% if not user.is_authenticated %}
    <div class="auth-required">
        <h2>Login Required</h2>
        <p>You must be logged in to view this page.</p>
        <a href="{% url 'login' %}">Login</a>
    </div>
{% else %}
<div class="page-header">
    <h1>{{ trip.name }}</h1>
    <p>{{ trip.description }}</p>
</div>

<!-- Trip Members Section -->
<div class="members-section">
    <div class="members-header">
        <div class="members-display">
            <span class="members-label">Trip Members:</span>
            <div class="members-list">
                {% for member in trip.get_members %}
                <div class="member-tag">
                    {% if member.user.trip_profile.first %}
                        {{ member.user.trip_profile.first.first_name }} {{ member.user.trip_profile.first.last_name }}
                    {% else %}
                        {{ member.user.username }}
                    {% endif %}
                    {% if is_organizer and member.user != request.user %}
                        <form method="POST" action="{% url 'remove_trip_member' trip.pk member.user.pk %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="remove-member-x" onclick="return confirm('Remove {{ member.user.username }} from this trip?')">×</button>
                        </form>
                    {% endif %}
                </div>
                {% empty %}
                <div class="member-tag empty">No members yet</div>
                {% endfor %}
            </div>
        </div>
        <a href="{% url 'invite_friends' trip.pk %}" class="btn btn-primary">+ Add Friends</a>
    </div>
</div>

<!-- Plans Section -->
<div class="plans-section">
    <div class="plans-header">
        <div class="plans-display">
            <span class="plans-label">Plans:</span>
            <div class="plans-list">
                {% for plan in trip.get_plans %}
                <div class="plan-tag {% if plan.is_selected %}selected{% endif %}" data-plan-id="{{ plan.pk }}">
                    {{ plan.name }}
                    {% if plan.is_selected %}
                        <span class="selected-icon">✓</span>
                    {% endif %}
                </div>
                {% empty %}
                <div class="plan-tag empty">No plans yet</div>
                {% endfor %}
            </div>
        </div>
        <button class="btn btn-primary" onclick="location.href='{% url 'create_plan' trip.pk %}'">+ Create Plan</button>
    </div>
</div>

<!-- Destinations Section -->
<div class="destinations-section">
    <div class="destinations-header">
        <span class="destinations-label">Destinations:</span>
        <div class="destinations-content">
            {% for plan in trip.get_plans %}
            <div class="plan-destinations" data-plan="{{ plan.pk }}">
                {% if plan.get_destinations %}
                    <div class="destinations-list">
                        {% for destination in plan.get_destinations %}
                        <div class="destination-tag">
                            {{ destination.city }}, {{ destination.country }}
                            {% if destination.nights_staying %}
                                <span class="detail">{{ destination.nights_staying }}n</span>
                            {% endif %}
                            {% if destination.estimated_cost %}
                                <span class="detail cost">${{ destination.estimated_cost }}</span>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="destination-tag empty">No destinations yet</div>
                {% endif %}
            </div>
            {% empty %}
            <div class="destination-tag empty">Create a plan first</div>
            {% endfor %}
        </div>
    </div>
</div>


<!-- New Tabbed Section -->
<div class="tabbed-section">
    <div class="tab-navigation">
        <button class="tab-btn active" data-tab="flights">Flights</button>
        <button class="tab-btn" data-tab="housing">Housing</button>
        <button class="tab-btn" data-tab="list">List</button>
    </div>
    
    <!-- Flights Tab Content -->
    <div class="tab-content active" id="flights-tab">
        <div class="tab-header">
            <h3>Flight Search</h3>
        </div>
        
        <!-- Flight Search Form -->
        <div class="flight-search-container">
            <form id="flight-search-form" class="flight-search-form">
                {% csrf_token %}
                <div class="search-row">
                    <div class="search-field">
                        <label for="{{ flight_search_form.departure_city.id_for_label }}">From:</label>
                        {{ flight_search_form.departure_city }}
                    </div>
                    <div class="search-field">
                        <label for="{{ flight_search_form.arrival_city.id_for_label }}">To:</label>
                        {{ flight_search_form.arrival_city }}
                    </div>
                    <div class="search-field">
                        <label for="{{ flight_search_form.departure_date.id_for_label }}">Departure:</label>
                        {{ flight_search_form.departure_date }}
                    </div>
                    <div class="search-field">
                        <label for="{{ flight_search_form.return_date.id_for_label }}">Return (Optional):</label>
                        {{ flight_search_form.return_date }}
                    </div>
                </div>
                
                <div class="search-row">
                    <div class="search-field">
                        <label for="{{ flight_search_form.travel_class.id_for_label }}">Class:</label>
                        {{ flight_search_form.travel_class }}
                    </div>
                    <div class="search-field">
                        <label for="{{ flight_search_form.adults.id_for_label }}">Adults:</label>
                        {{ flight_search_form.adults }}
                    </div>
                    <div class="search-field search-button">
                        <button type="submit" class="btn btn-primary">Search Flights</button>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Loading indicator -->
        <div id="flight-loading" class="loading-indicator" style="display: none;">
            <div class="loading-spinner"></div>
            <p>Searching for flights...</p>
        </div>
        
        <!-- Flight Results -->
        <div id="flight-results" class="flight-results" style="display: none;">
            <div class="results-header">
                <h4>Flight Results</h4>
                <div class="results-count"></div>
            </div>
            <div class="flight-list"></div>
            
            <!-- Pagination -->
            <div class="flight-pagination" style="display: none;">
                <button id="prev-flights" class="page-btn" disabled>← Previous</button>
                <span class="page-info"></span>
                <button id="next-flights" class="page-btn">Next →</button>
            </div>
        </div>
    </div>

    <!-- Housing Tab Content -->
    <div class="tab-content" id="housing-tab">
        <div class="tab-header">
            <h3>Hotel Search</h3>
        </div>
        
        <!-- Hotel Search Form -->
        <div class="hotel-search-container">
            <form id="hotel-search-form" class="hotel-search-form">
                {% csrf_token %}
                <div class="search-row">
                    <div class="search-field">
                        <label for="{{ hotel_search_form.city.id_for_label }}">City:</label>
                        {{ hotel_search_form.city }}
                    </div>
                    <div class="search-field">
                        <label for="{{ hotel_search_form.check_in_date.id_for_label }}">Check-in:</label>
                        {{ hotel_search_form.check_in_date }}
                    </div>
                    <div class="search-field">
                        <label for="{{ hotel_search_form.check_out_date.id_for_label }}">Check-out:</label>
                        {{ hotel_search_form.check_out_date }}
                    </div>
                </div>
                
                <div class="search-row">
                    <div class="search-field">
                        <label for="{{ hotel_search_form.adults.id_for_label }}">Adults:</label>
                        {{ hotel_search_form.adults }}
                    </div>
                    <div class="search-field">
                        <label for="{{ hotel_search_form.children.id_for_label }}">Children:</label>
                        {{ hotel_search_form.children }}
                    </div>
                    <div class="search-field search-button">
                        <button type="submit" class="btn btn-primary">Search Hotels</button>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Loading indicator -->
        <div id="hotel-loading" class="loading-indicator" style="display: none;">
            <div class="loading-spinner"></div>
            <p>Searching for hotels...</p>
        </div>
        
        <!-- Hotel Results -->
        <div id="hotel-results" class="hotel-results" style="display: none;">
            <div class="results-header">
                <h4>Hotel Results</h4>
                <div class="results-count"></div>
            </div>
            <div class="hotel-list"></div>
            
            <!-- Pagination -->
            <div class="hotel-pagination" style="display: none;">
                <button id="prev-hotels" class="page-btn" disabled>← Previous</button>
                <span class="page-info"></span>
                <button id="next-hotels" class="page-btn">Next →</button>
            </div>
        </div>
    </div>


    <!-- List Tab Content -->
    <div class="tab-content" id="list-tab">
        <div class="tab-header">
            <h3>Trip List</h3>
            <button class="add-btn" onclick="showAddItemForm()">+ Add Custom Item</button>
        </div>
        
        <!-- Add Item Form (hidden by default) -->
        <div class="add-item-form" id="add-item-form" style="display: none;">
            <div class="form-group">
                <input type="text" id="item-title" placeholder="Item title" class="form-input" required>
            </div>
            <div class="form-group">
                <input type="number" id="item-price" placeholder="Price (optional)" class="form-input" step="0.01" min="0">
                <small class="help-text">Enter price</small>
            </div>
            <div class="form-actions">
                <button class="btn-save" onclick="addCustomItem()">Save Item</button>
                <button class="btn-cancel" onclick="hideAddItemForm()">Cancel</button>
            </div>
        </div>

        <div class="content-list" id="trip-list-content">
            <!-- Display existing saved items -->
            {% for item in list_items %}
            <div class="list-item saved-item" data-item-id="{{ item.id }}">
                <div class="item-main">
                    <div class="item-title">
                        {% if item.item_type == 'flight' %}✈️{% elif item.item_type == 'hotel' %}🏨{% else %}📝{% endif %}
                        {{ item.title }}
                    </div>
                    {% if item.item_type != 'custom' %}
                        <div class="item-description">{{ item.description }}</div>
                    {% endif %}
                    <small class="added-info">Added by {{ item.added_by.username }} on {{ item.added_date|date:"M j, Y" }}</small>
                </div>
                {% if item.price %}
                <div class="item-price">${{ item.price }}</div>
                {% endif %}
                <div class="item-actions">
                    {% if item.added_by == request.user or is_organizer %}
                    <button class="btn-delete" onclick="removeListItem({{ item.id }})">Delete</button>
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <div class="empty-list" id="empty-list-message">
                <p>No items in your trip list yet.</p>
                <p>Add flights, hotels, or custom items from the search results above!</p>
            </div>
            {% endfor %}
            
            <!-- Pagination -->
            <div class="pagination">
                <button class="page-btn" disabled>← Previous</button>
                <span class="page-info">Page 1 of 1</span>
                <button class="page-btn" disabled>Next →</button>
            </div>
        </div>

    </div>  
</div>


<!-- Trip Details -->
<div class="trip-details">
    <div class="trip-info">
        <h3>Trip Information</h3>
        <p><strong>Start Date:</strong> {{ trip.start_date|date:"F j, Y" }}</p>
        <p><strong>End Date:</strong> {{ trip.end_date|date:"F j, Y" }}</p>
        <p><strong>Status:</strong> {{ trip.get_status_display }}</p>
        {% if trip.budget_limit %}
            <p><strong>Budget Limit:</strong> ${{ trip.budget_limit }}</p>
        {% endif %}
    </div>
</div>

<script>
// Tab functionality
document.addEventListener('DOMContentLoaded', function() {
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const targetTab = this.dataset.tab;
            
            // Remove active class from all tabs and contents
            tabBtns.forEach(b => b.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            // Add active class to clicked tab and corresponding content
            this.classList.add('active');
            document.getElementById(targetTab + '-tab').classList.add('active');
        });
    });
});

// Flight Search Functionality
let currentSearchParams = {};
let nextPageToken = null;

document.getElementById('flight-search-form').addEventListener('submit', function(e) {
    e.preventDefault();
    searchFlights();
});

function searchFlights(pageToken = null) {
    const form = document.getElementById('flight-search-form');
    const formData = new FormData(form);
    
    // Build search parameters
    const searchParams = {
        departure_city: formData.get('departure_city'),
        arrival_city: formData.get('arrival_city'),
        departure_date: formData.get('departure_date'),
        return_date: formData.get('return_date'),
        travel_class: formData.get('travel_class'),
        adults: formData.get('adults'),
    };
    
    // Add page token if provided
    if (pageToken) {
        searchParams.page_token = pageToken;
    }
    
    // Store current search params
    currentSearchParams = searchParams;
    
    // Show loading
    document.getElementById('flight-loading').style.display = 'block';
    document.getElementById('flight-results').style.display = 'none';
    
    // Make AJAX request
    fetch(`{% url 'search_flights' trip.pk %}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
        },
        body: JSON.stringify(searchParams)
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('flight-loading').style.display = 'none';
        
        if (data.error) {
            alert('Error: ' + data.error);
            return;
        }
        
        displayFlightResults(data);
    })
    .catch(error => {
        document.getElementById('flight-loading').style.display = 'none';
        alert('Error searching for flights: ' + error.message);
    });
}

function displayFlightResults(data) {
    const resultsContainer = document.getElementById('flight-results');
    const flightList = resultsContainer.querySelector('.flight-list');
    const resultsCount = resultsContainer.querySelector('.results-count');
    
    // Clear previous results
    flightList.innerHTML = '';
    
    // Update results count
    resultsCount.textContent = `Found ${data.flights.length} flights`;
    
    // Display flights
    data.flights.forEach(flight => {
        const flightCard = createFlightCard(flight);
        flightList.appendChild(flightCard);
    });
    
    // Update pagination
    updateFlightPagination(data.pagination);
    
    // Show results
    resultsContainer.style.display = 'block';
}

function createFlightCard(flight) {
    const card = document.createElement('div');
    card.className = 'flight-card';
    
    const stopsText = flight.stops === 0 ? 'Nonstop' : 
                     flight.stops === 1 ? '1 stop' : `${flight.stops} stops`;
    
    card.innerHTML = `
        <div class="flight-card-content">
            <div class="flight-route">
                <div class="airport-info">
                    <div class="airport-code">${flight.departure_code}</div>
                    <div class="airport-time">${formatTime(flight.departure_time)}</div>
                </div>
                <div class="flight-duration">
                    <div class="duration-line">
                        <span class="duration-text">${flight.duration_formatted}</span>
                        <div class="route-line"></div>
                    </div>
                    <div class="stops-info">${stopsText}</div>
                </div>
                <div class="airport-info">
                    <div class="airport-code">${flight.arrival_code}</div>
                    <div class="airport-time">${formatTime(flight.arrival_time)}</div>
                </div>
            </div>
            
            <div class="flight-details">
                <div class="airline-info">
                    <img src="${flight.airline_logo}" alt="${flight.airline}" class="airline-logo" onerror="this.style.display='none'">
                    <span class="airline-name">${flight.airline}</span>
                </div>
                <div class="flight-price">
                    <span class="price">$${flight.price}</span>
                    <span class="price-label">per person</span>
                </div>
            </div>
        </div>
        
        <div class="flight-actions">
            <button class="add-to-list-btn" onclick="addFlightToList({
                title: '${flight.departure_code} → ${flight.arrival_code}',
                departure_code: '${flight.departure_code}',
                arrival_code: '${flight.arrival_code}',
                departure_time: '${flight.departure_time}',
                arrival_time: '${flight.arrival_time}',
                duration_formatted: '${flight.duration_formatted}',
                airline: '${flight.airline}',
                price: ${flight.price},
                stops: ${flight.stops},
                stops_text: '${stopsText}',
                booking_token: '${flight.booking_token}'
            })">
                + Add to List
            </button>
        </div>
    `;
    
    return card;
}

function formatTime(timeString) {
    if (!timeString) return 'N/A';
    
    // Extract time from datetime string (assuming format like "2025-06-27 15:30")
    const timePart = timeString.split(' ')[1];
    if (!timePart) return timeString;
    
    const [hours, minutes] = timePart.split(':');
    const hour24 = parseInt(hours);
    const hour12 = hour24 === 0 ? 12 : hour24 > 12 ? hour24 - 12 : hour24;
    const ampm = hour24 >= 12 ? 'PM' : 'AM';
    
    return `${hour12}:${minutes} ${ampm}`;
}

function updateFlightPagination(pagination) {
    const paginationContainer = document.querySelector('.flight-pagination');
    const pageInfo = paginationContainer.querySelector('.page-info');
    const prevBtn = document.getElementById('prev-flights');
    const nextBtn = document.getElementById('next-flights');
    
    // Update page info
    pageInfo.textContent = `Showing ${pagination.current_from}-${pagination.current_to}`;
    
    // Update pagination buttons
    nextBtn.disabled = !pagination.has_next;
    nextPageToken = pagination.next_page_token;
    
    // Show pagination if there are multiple pages
    if (pagination.has_next || pagination.current_from > 1) {
        paginationContainer.style.display = 'flex';
    } else {
        paginationContainer.style.display = 'none';
    }
}

// Pagination event listeners
document.getElementById('next-flights').addEventListener('click', function() {
    if (nextPageToken) {
        searchFlights(nextPageToken);
    }
});

function addFlightToList(flightData) {
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    
    fetch(`{% url 'add_flight_to_list' trip.pk %}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken,
        },
        body: JSON.stringify(flightData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showSuccessMessage(data.message);
            refreshListTab();
        } else {
            alert('Error: ' + (data.error || 'Failed to add flight'));
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Failed to add flight to list');
    });
}

// Custom list functionality (existing code)
function showAddItemForm() {
    document.getElementById('add-item-form').style.display = 'block';
}

function hideAddItemForm() {
    document.getElementById('add-item-form').style.display = 'none';
    document.getElementById('item-title').value = '';
    document.getElementById('item-price').value = '';
}


function addCustomItem() {
    const title = document.getElementById('item-title').value;
    const price = document.getElementById('item-price').value;
    
    if (!title.trim()) {
        alert('Please enter a title for the item');
        return;
    }
    
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    
    const itemData = {
        title: title,
        price: price ? parseFloat(price) : null
    };
    
    console.log('Adding custom item:', itemData); // Debug line
    
    fetch(`{% url 'add_custom_item' trip.pk %}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken,
        },
        body: JSON.stringify(itemData)
    })
    .then(response => {
        console.log('Custom item response status:', response.status);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        console.log('Custom item response data:', data);
        if (data.success) {
            showSuccessMessage(data.message);
            hideAddItemForm();
            refreshListTab();
        } else {
            console.error('Server error:', data.error);
            alert('Error: ' + (data.error || 'Failed to add item'));
        }
    })
    .catch(error => {
        console.error('Network error:', error);
        alert('Failed to add custom item: ' + error.message);
    });
}


document.addEventListener('DOMContentLoaded', function() {
    const planTags = document.querySelectorAll('.plan-tag:not(.empty)');
    const planDestinations = document.querySelectorAll('.plan-destinations');
    const destinationsSection = document.querySelector('.destinations-section');
    
    // Show destinations for selected plan on page load
    const selectedPlan = document.querySelector('.plan-tag.selected');
    if (selectedPlan) {
        const planId = selectedPlan.getAttribute('data-plan-id');
        showDestinationsForPlan(planId);
    } else {
        // Hide destinations section if no plan is selected
        destinationsSection.style.display = 'none';
    }
    
    planTags.forEach(tag => {
        tag.addEventListener('click', function() {
            const planId = this.getAttribute('data-plan-id');
            
            // Remove selected class from all plans
            planTags.forEach(t => t.classList.remove('selected'));
            
            // Add selected class to clicked plan
            this.classList.add('selected');
            
            // Update selected icon
            planTags.forEach(t => {
                const icon = t.querySelector('.selected-icon');
                if (icon) icon.remove();
            });
            
            if (!this.querySelector('.selected-icon')) {
                this.insertAdjacentHTML('beforeend', '<span class="selected-icon">✓</span>');
            }
            
            // Show destinations section and destinations for this plan
            destinationsSection.style.display = 'block';
            showDestinationsForPlan(planId);
        });
    });
    
    function showDestinationsForPlan(planId) {
        // Hide all plan destinations
        planDestinations.forEach(pd => pd.classList.remove('active'));
        
        // Show destinations for selected plan
        const targetDestinations = document.querySelector(`[data-plan="${planId}"]`);
        if (targetDestinations) {
            targetDestinations.classList.add('active');
        }
    }
});

// Hotel Search Functionality
let currentHotelSearchParams = {};
let nextHotelPageToken = null;

// Add the hotel form event listener
document.getElementById('hotel-search-form').addEventListener('submit', function(e) {
    e.preventDefault();
    searchHotels();
});

function searchHotels(pageToken = null) {
    const form = document.getElementById('hotel-search-form');
    const formData = new FormData(form);
    
    // Build search parameters
    const searchParams = {
        city: formData.get('city'),
        check_in_date: formData.get('check_in_date'),
        check_out_date: formData.get('check_out_date'),
        adults: formData.get('adults'),
        children: formData.get('children'),
    };
    
    // Add page token if provided
    if (pageToken) {
        searchParams.page_token = pageToken;
    }
    
    // Store current search params
    currentHotelSearchParams = searchParams;
    
    // Show loading
    document.getElementById('hotel-loading').style.display = 'block';
    document.getElementById('hotel-results').style.display = 'none';
    
    // Make AJAX request
    fetch(`{% url 'search_hotels' trip.pk %}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
        },
        body: JSON.stringify(searchParams)
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('hotel-loading').style.display = 'none';
        
        if (data.error) {
            alert('Error: ' + data.error);
            return;
        }
        
        displayHotelResults(data);
    })
    .catch(error => {
        document.getElementById('hotel-loading').style.display = 'none';
        alert('Error searching for hotels: ' + error.message);
    });
}

function displayHotelResults(data) {
    const resultsContainer = document.getElementById('hotel-results');
    const hotelList = resultsContainer.querySelector('.hotel-list');
    const resultsCount = resultsContainer.querySelector('.results-count');
    
    // Clear previous results
    hotelList.innerHTML = '';
    
    // Update results count
    resultsCount.textContent = `Found ${data.hotels.length} hotels for ${data.nights} night${data.nights > 1 ? 's' : ''}`;
    
    // Display hotels
    data.hotels.forEach(hotel => {
        const hotelCard = createHotelCard(hotel, data.nights);
        hotelList.appendChild(hotelCard);
    });
    
    // Update pagination
    updateHotelPagination(data.pagination);
    
    // Show results
    resultsContainer.style.display = 'block';
}

function createHotelCard(hotel, nights) {
    const card = document.createElement('div');
    card.className = 'hotel-card';
    
    // Create star rating display
    const starRating = generateStarRating(hotel.star_rating);
    
    // Format amenities (show first 3)
    const displayAmenities = hotel.amenities.slice(0, 3);
    const moreAmenities = hotel.amenities.length > 3 ? `+${hotel.amenities.length - 3} more` : '';
    
    // Escape quotes in hotel name and amenities for JSON
    const escapedName = hotel.name.replace(/'/g, "\\'").replace(/"/g, '\\"');
    const escapedAmenities = JSON.stringify(hotel.amenities).replace(/'/g, "\\'");
    
    card.innerHTML = `
        <div class="hotel-card-content">
            <div class="hotel-image">
                <img src="${hotel.image_url || 'https://via.placeholder.com/200x150?text=Hotel'}" 
                     alt="${hotel.name}" 
                     onerror="this.src='https://via.placeholder.com/200x150?text=Hotel'">
            </div>
            
            <div class="hotel-details">
                <div class="hotel-header">
                    <h4 class="hotel-name">${hotel.name}</h4>
                    <div class="hotel-rating">
                        <span class="stars">${starRating}</span>
                        <span class="rating-score">${hotel.rating || 'N/A'}</span>
                        <span class="review-count">(${hotel.reviews || 0} reviews)</span>
                    </div>
                </div>
                
                <div class="hotel-amenities">
                    ${displayAmenities.map(amenity => `<span class="amenity-tag">${amenity}</span>`).join('')}
                    ${moreAmenities ? `<span class="more-amenities">${moreAmenities}</span>` : ''}
                </div>
                
                <div class="hotel-pricing">
                    <div class="price-per-night">
                        <span class="price">${hotel.price_per_night}</span>
                        <span class="price-label">per night</span>
                    </div>
                    <div class="total-price">
                        <span class="total">${hotel.total_price}</span>
                        <span class="total-label">total for ${nights} night${nights > 1 ? 's' : ''}</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="hotel-actions">
            <button class="add-to-list-btn" onclick="addHotelToListWrapper('${escapedName}', ${hotel.rating || 0}, ${hotel.star_rating || 0}, '${hotel.price_per_night}', ${hotel.price_per_night_value || 0}, '${hotel.total_price}', ${hotel.total_price_value || 0}, '${escapedAmenities}', '${hotel.property_token}', ${hotel.reviews || 0})">
                + Add to List
            </button>
        </div>
    `;
    
    return card;
}


function addHotelToListWrapper(name, rating, starRating, pricePerNight, pricePerNightValue, totalPrice, totalPriceValue, amenitiesJson, propertyToken, reviews) {
    console.log('addHotelToListWrapper called with:', {
        name, rating, starRating, pricePerNight, pricePerNightValue, 
        totalPrice, totalPriceValue, amenitiesJson, propertyToken, reviews
    });
    
    // Parse amenities back from JSON string
    let amenities = [];
    try {
        amenities = JSON.parse(amenitiesJson);
    } catch (e) {
        console.error('Error parsing amenities:', e);
        amenities = [];
    }
    
    const hotelData = {
        name: name,
        rating: rating,
        star_rating: starRating,
        price_per_night: pricePerNight,
        price_per_night_value: pricePerNightValue,
        total_price: totalPrice,
        total_price_value: totalPriceValue,
        amenities: amenities,
        property_token: propertyToken,
        reviews: reviews
    };
    
    console.log('Calling addHotelToList with:', hotelData);
    addHotelToList(hotelData);
}


function generateStarRating(rating) {
    if (!rating) return '';
    
    const fullStars = '★'.repeat(Math.floor(rating));
    const emptyStars = '☆'.repeat(5 - Math.floor(rating));
    
    return fullStars + emptyStars;
}

function updateHotelPagination(pagination) {
    const paginationContainer = document.querySelector('.hotel-pagination');
    const pageInfo = paginationContainer.querySelector('.page-info');
    const prevBtn = document.getElementById('prev-hotels');
    const nextBtn = document.getElementById('next-hotels');
    
    // Update page info
    pageInfo.textContent = `Showing ${pagination.current_from}-${pagination.current_to}`;
    
    // Update pagination buttons
    nextBtn.disabled = !pagination.has_next;
    nextHotelPageToken = pagination.next_page_token;
    
    // Show pagination if there are multiple pages
    if (pagination.has_next || pagination.current_from > 1) {
        paginationContainer.style.display = 'flex';
    } else {
        paginationContainer.style.display = 'none';
    }
}

// Hotel pagination event listeners
document.getElementById('next-hotels').addEventListener('click', function() {
    if (nextHotelPageToken) {
        searchHotels(nextHotelPageToken);
    }
});

function addHotelToList(hotelData) {
    console.log('addHotelToList called with:', hotelData);
    
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    
    fetch(`{% url 'add_hotel_to_list' trip.pk %}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken,
        },
        body: JSON.stringify(hotelData)
    })
    .then(response => {
        console.log('Response status:', response.status);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        console.log('Response data:', data);
        if (data.success) {
            showSuccessMessage(data.message);
            refreshListTab();
        } else {
            console.error('Server error:', data.error);
            alert('Error: ' + (data.error || 'Failed to add hotel'));
        }
    })
    .catch(error => {
        console.error('Network error:', error);
        alert('Failed to add hotel to list: ' + error.message);
    });
}

function removeListItem(itemId) {
    if (!confirm('Are you sure you want to remove this item from the list?')) {
        return;
    }
    
    console.log('Removing item:', itemId); // Debug line
    
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    
    // Use Django URL template tag instead of hardcoded URL
    const removeUrl = `{% url 'remove_list_item' trip.pk 0 %}`.replace('0', itemId);
    
    console.log('Remove URL:', removeUrl); // Debug line
    
    fetch(removeUrl, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken,
        }
    })
    .then(response => {
        console.log('Remove response status:', response.status); // Debug line
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        console.log('Remove response data:', data); // Debug line
        if (data.success) {
            showSuccessMessage(data.message);
            // Remove the item from the DOM immediately
            const itemElement = document.querySelector(`[data-item-id="${itemId}"]`);
            if (itemElement) {
                itemElement.remove();
            }
            
            // Check if list is empty and show empty message
            const remainingItems = document.querySelectorAll('.saved-item');
            if (remainingItems.length === 0) {
                showEmptyListMessage();
            }
        } else {
            console.error('Server error:', data.error);
            alert('Error: ' + (data.error || 'Failed to remove item'));
        }
    })
    .catch(error => {
        console.error('Network error:', error);
        alert('Failed to remove item: ' + error.message);
    });
}

// Function to refresh the list tab (reload page or fetch updated content)
function refreshListTab() {
    // Simple approach: reload the page
    // For a more sophisticated approach, you could fetch just the list content via AJAX
    location.reload();
}

// Function to show success message
function showSuccessMessage(message) {
    // Create a temporary success message
    const successDiv = document.createElement('div');
    successDiv.className = 'success-message';
    successDiv.textContent = message;
    successDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #28a745;
        color: white;
        padding: 10px 20px;
        border-radius: 4px;
        z-index: 1000;
        animation: slideIn 0.3s ease-out;
    `;
    
    document.body.appendChild(successDiv);
    
    // Remove after 3 seconds
    setTimeout(() => {
        successDiv.remove();
    }, 3000);
}


// Function to show empty list message
function showEmptyListMessage() {
    const contentList = document.getElementById('trip-list-content');
    const pagination = contentList.querySelector('.pagination');
    
    const emptyMessage = document.createElement('div');
    emptyMessage.className = 'empty-list';
    emptyMessage.id = 'empty-list-message';
    emptyMessage.innerHTML = `
    <p>No items in your trip list yet.</p>
    <p>Add flights, hotels, or custom items from the search results above!</p>
`;

contentList.insertBefore(emptyMessage, pagination);
}

// Add CSS animation for success message
const style = document.createElement('style');
style.textContent = `
@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.success-message {
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.saved-item {
    border-left: 4px solid #28a745;
    background: #f8f9fa;
}

.saved-item:hover {
    background: #e9ecef;
}

.added-info {
    color: #6c757d;
    font-size: 12px;
    margin-top: 5px;
    display: block;
}

.empty-list {
    text-align: center;
    padding: 60px 20px;
    color: #666;
    font-style: italic;
}

.empty-list p {
    margin-bottom: 15px;
}
`;
document.head.appendChild(style);

</script>
{% endif %}

<style>

.destinations-section {
    margin-bottom: 30px;
    padding: 15px 20px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.destinations-section h2 {
    margin-bottom: 15px;
    color: #333;
}

.plans-section {
    margin-bottom: 30px;
    padding: 20px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.plans-section h2 {
    margin-bottom: 15px;
    color: #333;
}

.plans-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.plan-btn {
    padding: 10px 20px;
    border: 2px solid #ddd;
    background: white;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
}

.plan-btn:hover {
    border-color: #3b5998;
    background: #f0f2ff;
}

.plan-btn.selected {
    background: #3b5998;
    color: white;
    border-color: #3b5998;
}

.new-plan-btn {
    background: #5cb85c;
    color: white;
    border-color: #5cb85c;
}

.new-plan-btn:hover {
    background: #449d44;
    border-color: #449d44;
}

/* Flight Search Styles */
.flight-search-container {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 30px;
}

.flight-search-form {
    max-width: none;
}

.search-row {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
    align-items: end;
}

.search-field {
    flex: 1;
    min-width: 150px;
}

.search-field.search-button {
    flex: 0 0 auto;
}

.search-field label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: #333;
    font-size: 14px;
}

.search-field input,
.search-field select {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
}

.search-field input:focus,
.search-field select:focus {
    outline: none;
    border-color: #3b5998;
    box-shadow: 0 0 0 2px rgba(59, 89, 152, 0.1);
}

/* Loading Indicator */
.loading-indicator {
    text-align: center;
    padding: 40px 20px;
    color: #666;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #3b5998;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 15px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Flight Results */
.flight-results {
    margin-top: 20px;
}

.results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
}

.results-header h4 {
    margin: 0;
    color: #333;
}

.results-count {
    color: #666;
    font-size: 14px;
}

.flight-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.flight-card {
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 20px;
    transition: box-shadow 0.2s, transform 0.2s;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.flight-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transform: translateY(-1px);
}

.flight-card-content {
    flex: 1;
}

.flight-route {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
}

.airport-info {
    text-align: center;
    min-width: 80px;
}

.airport-code {
    font-size: 18px;
    font-weight: bold;
    color: #333;
    margin-bottom: 4px;
}

.airport-time {
    font-size: 13px;
    color: #666;
}

.flight-duration {
    flex: 1;
    text-align: center;
    padding: 0 20px;
}

.duration-line {
    position: relative;
    margin-bottom: 5px;
}

.duration-text {
    background: white;
    padding: 0 10px;
    font-size: 13px;
    color: #666;
    font-weight: 500;
}

.route-line {
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 2px;
    background: #ddd;
    z-index: -1;
}

.stops-info {
    font-size: 12px;
    color: #999;
}

.flight-details {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.airline-info {
    display: flex;
    align-items: center;
    gap: 8px;
}

.airline-logo {
    width: 24px;
    height: 24px;
    object-fit: contain;
}

.airline-name {
    font-size: 14px;
    color: #666;
}

.flight-price {
    text-align: right;
}

.price {
    font-size: 20px;
    font-weight: bold;
    color: #3b5998;
}

.price-label {
    display: block;
    font-size: 12px;
    color: #999;
}

.flight-actions {
    margin-left: 20px;
}

.add-to-list-btn {
    background: #5cb85c;
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: background-color 0.3s;
}

.add-to-list-btn:hover {
    background: #449d44;
}

.flight-pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #eee;
}

/* Tabbed Section Styles */
.tabbed-section {
    margin-bottom: 30px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    overflow: hidden;
}

.tab-navigation {
    display: flex;
    background: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
}

.tab-btn {
    flex: 1;
    padding: 15px 20px;
    border: none;
    background: transparent;
    cursor: pointer;
    font-size: 16px;
    font-weight: 500;
    color: #666;
    transition: all 0.3s;
}

.tab-btn:hover {
    background: rgba(59, 89, 152, 0.1);
    color: #3b5998;
}

.tab-btn.active {
    background: white;
    color: #3b5998;
    border-bottom: 3px solid #3b5998;
}

.tab-content {
    display: none;
    padding: 25px;
}

.tab-content.active {
    display: block;
}

.tab-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.tab-header h3 {
    margin: 0;
    color: #333;
    font-size: 20px;
}

.add-btn {
    background: #5cb85c;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
}

.add-btn:hover {
    background: #449d44;
}

/* List Item Styles */
.content-list {
    max-height: 600px;
    overflow-y: auto;
}

.list-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    margin-bottom: 10px;
    background: #f8f9fa;
    transition: transform 0.2s, box-shadow 0.2s;
}

.list-item:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.item-main {
    flex: 1;
}

/* Housing-specific styles */
.housing-name {
    font-weight: bold;
    font-size: 16px;
    color: #333;
    margin-bottom: 5px;
}

.housing-details {
    display: flex;
    gap: 15px;
    font-size: 14px;
    color: #666;
}

.rating {
    color: #ff9500;
}

/* Custom list styles */
.item-title {
    font-weight: bold;
    font-size: 16px;
    color: #333;
    margin-bottom: 5px;
}

.item-description {
    font-size: 14px;
    color: #666;
}

.item-price {
    font-weight: bold;
    font-size: 18px;
    color: #3b5998;
    margin: 0 20px;
}

.item-actions {
    display: flex;
    gap: 8px;
}

.btn-select, .btn-edit, .btn-delete, .btn-save, .btn-cancel {
    padding: 6px 12px;
    border: none;
    border-radius: 3px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
}

.btn-select {
    background: #3b5998;
    color: white;
}

.btn-select:hover {
    background: #2d4373;
}

.btn-edit {
    background: #ffc107;
    color: #333;
}

.btn-edit:hover {
    background: #e0a800;
}

.btn-delete {
    background: #dc3545;
    color: white;
}

.btn-delete:hover {
    background: #c82333;
}

.btn-save {
    background: #28a745;
    color: white;
}

.btn-save:hover {
    background: #218838;
}

.btn-cancel {
    background: #6c757d;
    color: white;
}

.btn-cancel:hover {
    background: #5a6268;
}

/* Add Item Form */
.add-item-form {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 6px;
    margin-bottom: 20px;
    border: 1px solid #dee2e6;
}

.form-group {
    margin-bottom: 15px;
}

.form-input {
    width: 100%;
    padding: 10px;
    border: 1px solid #ced4da;
    border-radius: 4px;
    font-size: 14px;
}

.form-input:focus {
    outline: none;
    border-color: #3b5998;
    box-shadow: 0 0 0 2px rgba(59, 89, 152, 0.1);
}

.form-actions {
    display: flex;
    gap: 10px;
}

/* Pagination */
.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #dee2e6;
}

.page-btn {
    padding: 8px 16px;
    border: 1px solid #dee2e6;
    background: white;
    color: #3b5998;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
}

.page-btn:hover:not(:disabled) {
    background: #f8f9fa;
}

.page-btn:disabled {
    color: #6c757d;
    cursor: not-allowed;
    opacity: 0.6;
}

.page-info {
    font-size: 14px;
    color: #666;
}

.trip-details {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.trip-info h3 {
    margin-bottom: 15px;
    color: #333;
}

.trip-info p {
    margin-bottom: 8px;
}

/* Responsive Design */
@media (max-width: 768px) {
    .search-row {
        flex-direction: column;
        gap: 10px;
    }
    
    .search-field {
        min-width: auto;
    }
    
    .tab-navigation {
        flex-direction: column;
    }
    
    .tab-btn {
        flex: none;
    }
    
    .tab-header {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
    
    .flight-card {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }
    
    .flight-route {
        flex-direction: column;
        gap: 10px;
    }
    
    .flight-duration {
        padding: 10px 0;
    }
    
    .flight-actions {
        margin-left: 0;
        align-self: stretch;
    }
    
    .add-to-list-btn {
        width: 100%;
    }
    
    .list-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .item-actions {
        align-self: stretch;
        justify-content: flex-end;
    }
    
    .item-price {
        margin: 0;
        align-self: flex-end;
    }
}

.members-section {
    margin-bottom: 30px;
    padding: 15px 20px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.members-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
}

.members-display {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
}

.members-label {
    font-weight: bold;
    color: #333;
    font-size: 16px;
    white-space: nowrap;
}

.members-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.member-tag {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 20px;
    padding: 6px 12px;
    font-size: 14px;
    color: #333;
    display: flex;
    align-items: center;
    gap: 5px;
    position: relative;
}

.member-tag.empty {
    color: #666;
    font-style: italic;
}

.organizer-icon {
    color: #ffc107;
    font-size: 12px;
    margin-left: 2px;
}

.remove-member-x {
    background: none;
    border: none;
    color: #dc3545;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    padding: 0;
    margin-left: 5px;
    width: 16px;
    height: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background-color 0.3s;
}

.remove-member-x:hover {
    background: #dc3545;
    color: white;
}

/* Updated Plans Section Styles - More Condensed */
.plans-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
}

.plans-display {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
}

.plans-label {
    font-weight: bold;
    color: #333;
    font-size: 16px;
    white-space: nowrap;
}

.plans-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.plan-tag {
    background: #f8f9fa;
    border: 2px solid #dee2e6;
    border-radius: 20px;
    padding: 8px 15px;
    font-size: 14px;
    color: #333;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    transition: all 0.3s;
    user-select: none;
}

.plan-tag:hover {
    border-color: #3b5998;
    background: #f0f2ff;
}

.plan-tag.selected {
    background: #3b5998;
    color: white;
    border-color: #3b5998;
}

.plan-tag.empty {
    color: #666;
    font-style: italic;
    cursor: default;
}

.plan-tag.empty:hover {
    border-color: #dee2e6;
    background: #f8f9fa;
}

.selected-icon {
    font-size: 12px;
    margin-left: 2px;
}


.destinations-header {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
}

.destinations-label {
    font-weight: bold;
    color: #333;
    font-size: 16px;
    white-space: nowrap;
}

.destinations-header h3 {
    margin: 0;
    color: #333;
    font-size: 18px;
}

.destinations-content {
    display: flex;
    flex-wrap: wrap;
}

.plan-destinations {
    display: none;
}

.plan-destinations.active {
    display: block;
}

.destinations-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.destinations-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.destination-tag {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 20px;
    padding: 6px 12px;
    font-size: 14px;
    color: #333;
    display: flex;
    align-items: center;
    gap: 5px;
}

.destination-tag.empty {
    color: #666;
    font-style: italic;
}

.destination-card {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 20px;
    padding: 8px 15px;
    font-size: 14px;
    color: #333;
    display: flex;
    align-items: center;
    gap: 8px;
}

.destination-header {
    display: flex;
    align-items: center;
    gap: 5px;
}

.destination-header h4 {
    margin: 0;
    font-size: 14px;
    font-weight: 600;
}

.country {
    color: #666;
    font-size: 12px;
}

.destination-details {
    display: flex;
    gap: 8px;
    margin-left: auto;
}

.detail {
    background: white;
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 11px;
    color: #666;
    border: 1px solid #dee2e6;
    margin-left: 3px;
}

.detail.cost {
    color: #28a745;
    font-weight: bold;
}

.no-destinations, .no-plans-message {
    text-align: center;
    padding: 40px 20px;
    color: #666;
}

.hotel-search-container {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 30px;
}

.hotel-search-form {
    max-width: none;
}

.hotel-search-container {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 30px;
}

.hotel-search-form {
    max-width: none;
}

/* Hotel Results */
.hotel-results {
    margin-top: 20px;
}

.hotel-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.hotel-card {
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    overflow: hidden;
    transition: box-shadow 0.2s, transform 0.2s;
    display: flex;
    min-height: 200px;
}

.hotel-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transform: translateY(-1px);
}

.hotel-card-content {
    display: flex;
    flex: 1;
}

.hotel-image {
    width: 200px;
    flex-shrink: 0;
}

.hotel-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.hotel-details {
    flex: 1;
    padding: 20px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.hotel-header {
    margin-bottom: 15px;
}

.hotel-name {
    font-size: 18px;
    font-weight: bold;
    color: #333;
    margin-bottom: 8px;
}

.hotel-rating {
    display: flex;
    align-items: center;
    gap: 8px;
}

.stars {
    color: #ffa500;
    font-size: 16px;
}

.rating-score {
    font-weight: bold;
    color: #333;
}

.review-count {
    color: #666;
    font-size: 14px;
}

.hotel-amenities {
    margin-bottom: 15px;
}

.amenity-tag {
    display: inline-block;
    background: #e8f4f8;
    color: #2c5aa0;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    margin-right: 6px;
    margin-bottom: 4px;
}

.more-amenities {
    color: #666;
    font-size: 12px;
    font-style: italic;
}

.hotel-pricing {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: auto;
}

.price-per-night {
    text-align: left;
}

.price {
    font-size: 24px;
    font-weight: bold;
    color: #3b5998;
}

.price-label {
    display: block;
    font-size: 12px;
    color: #666;
}

.total-price {
    text-align: right;
}

.total {
    font-size: 18px;
    font-weight: bold;
    color: #28a745;
}

.total-label {
    display: block;
    font-size: 12px;
    color: #666;
}

.hotel-actions {
    display: flex;
    align-items: center;
    padding: 20px;
    border-left: 1px solid #e0e0e0;
}

.hotel-pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #eee;
}

/* Responsive design for hotel cards */
@media (max-width: 768px) {
    .hotel-card {
        flex-direction: column;
    }
    
    .hotel-card-content {
        flex-direction: column;
    }
    
    .hotel-image {
        width: 100%;
        height: 200px;
    }
    
    .hotel-pricing {
        flex-direction: column;
        gap: 10px;
        text-align: center;
    }
    
    .hotel-actions {
        border-left: none;
        border-top: 1px solid #e0e0e0;
        justify-content: center;
    }
    
    .add-to-list-btn {
        width: 100%;
    }
}
@media (max-width: 768px) {
    .search-row {
        flex-direction: column;
        gap: 10px;
    }
    
    .search-field {
        min-width: auto;
    }
    
    .tab-navigation {
        flex-direction: column;
    }
    
    .tab-btn {
        flex: none;
    }
    
    .tab-header {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
    
    .flight-card {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }
    
    .flight-route {
        flex-direction: column;
        gap: 10px;
    }
    
    .flight-duration {
        padding: 10px 0;
    }
    
    .flight-actions {
        margin-left: 0;
        align-self: stretch;
    }
    
    .add-to-list-btn {
        width: 100%;
    }
    
    .list-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .item-actions {
        align-self: stretch;
        justify-content: flex-end;
    }
    
    .item-price {
        margin: 0;
        align-self: flex-end;
    }
}

.help-text {
    display: block;
    color: #666;
    font-size: 12px;
    margin-top: 5px;
    font-style: italic;
}

.form-group input[type="number"] {
    width: 100%;
    padding: 10px;
    border: 1px solid #ced4da;
    border-radius: 4px;
    font-size: 14px;
}

.form-group input[type="number"]:focus {
    outline: none;
    border-color: #3b5998;
    box-shadow: 0 0 0 2px rgba(59, 89, 152, 0.1);
}

/* Ensure custom items without description still look good */
.list-item .item-main {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.list-item .item-title {
    font-weight: bold;
    font-size: 16px;
    color: #333;
}

.list-item .item-description {
    font-size: 14px;
    color: #666;
    margin-bottom: 5px;
}

.list-item .added-info {
    color: #6c757d;
    font-size: 12px;
}

</style>
{% endblock %}